###############################################################################
# HostGuard Pro - Main Configuration File
# /etc/hostguard/hostguard.conf
###############################################################################

###############################################################################
# SECTION: Initial Settings
###############################################################################

# Testing flag - enables a cron job that clears iptables rules after
# TESTING_INTERVAL minutes to prevent lockout during configuration.
# Set to 0 only after confirming the firewall works correctly.
# The daemon (hostguardd) will NOT start while TESTING = 1
TESTING = "1"

# Interval in minutes for the testing mode safety cron (1-60)
TESTING_INTERVAL = "5"

# Enable or disable the firewall entirely (1=enabled, 0=disabled)
ENABLED = "1"

# Restrict UI config changes (0=unrestricted, 1=restricted, 2=disabled)
RESTRICT_UI = "1"

###############################################################################
# SECTION: IPv4 Port Settings
###############################################################################
# Comma-separated port lists. Ranges use colon notation (e.g., 30000:35000)

# Stateful Packet Inspection (1=enabled, 0=static firewall fallback)
LF_SPI = "1"

# Allow incoming TCP ports
TCP_IN = "20,21,22,25,53,80,110,143,443,465,587,993,995,2077,2078,2079,2080,2082,2083,2086,2087,2095,2096,8443"

# Allow outgoing TCP ports
TCP_OUT = "20,21,22,25,37,43,53,80,110,113,443,587,873,993,995,2086,2087,2089"

# Allow incoming UDP ports
UDP_IN = "20,21,53,80,443"

# Allow outgoing UDP ports
UDP_OUT = "20,21,53,113,123,873,6277"

# Allow incoming PING (1=yes, 0=no)
ICMP_IN = "1"

# ICMP rate limit (e.g., "1/s", "0" to disable limiting)
ICMP_IN_RATE = "1/s"

# Allow outgoing PING (1=yes, 0=no)
ICMP_OUT = "1"

###############################################################################
# SECTION: IPv6 Port Settings
###############################################################################

# Enable IPv6 firewall support (requires ip6tables)
IPV6 = "0"

# IPv6 Stateful Packet Inspection
IPV6_SPI = "1"

# Allow incoming IPv6 TCP ports
TCP6_IN = "20,21,22,25,53,80,110,143,443,465,587,993,995,2077,2078,2082,2083,2086,2087,2095,2096,8443"

# Allow outgoing IPv6 TCP ports
TCP6_OUT = "20,21,22,25,37,43,53,80,110,113,443,587,873,993,995,2086,2087,2089"

# Allow incoming IPv6 UDP ports
UDP6_IN = "20,21,53,80,443"

# Allow outgoing IPv6 UDP ports
UDP6_OUT = "20,21,53,113,123,873,6277"

###############################################################################
# SECTION: General Settings
###############################################################################

# Network interface to filter (empty = all interfaces)
ETH_DEVICE = ""

# Network interfaces to skip, comma-separated (e.g., "docker0,veth+")
ETH_DEVICE_SKIP = ""

# Use conntrack module (1=conntrack, 0=deprecated state module)
USE_CONNTRACK = "1"

# SSH port for safety rules (must always be open from allowlist)
SSH_PORT = "22"

# Use ipset for large blocklists (1=yes, 0=no - falls back to individual rules)
LF_IPSET = "1"

# Drop mode for blocked packets
# DROP = silently drop, REJECT = send reject response
DROP_ACTION = "DROP"

# Log dropped packets (1=yes, 0=no)
DROP_LOGGING = "1"

# Maximum entries in the deny list (0=unlimited, recommended: 200-1000)
DENY_IP_LIMIT = "500"

# Maximum entries in temporary block list (0=unlimited)
DENY_TEMP_IP_LIMIT = "1000"

###############################################################################
# SECTION: Login Failure Daemon Settings
###############################################################################

# Enable login failure detection daemon
LF_DAEMON = "1"

# Parse interval in seconds for checking new log entries
LF_PARSE_INTERVAL = "3"

# --- Per-service failure thresholds ---
# Format: number of failures to trigger a block
# Set to 0 to disable detection for that service

# SSH login failures
LF_SSHD = "5"

# FTP login failures (pure-ftpd, proftpd)
LF_FTPD = "10"

# POP3 login failures (dovecot)
LF_POP3D = "10"

# IMAP login failures (dovecot)
LF_IMAPD = "10"

# SMTP AUTH failures (exim)
LF_SMTPAUTH = "5"

# cPanel/WHM login failures
LF_CPANEL = "10"

# Custom log pattern failures
LF_CUSTOM = "10"

# --- Timing ---

# Time window in seconds for counting failures (default: 3600 = 1 hour)
LF_INTERVAL = "3600"

# Cross-protocol aggregation: count failures across all services for one IP
# toward a single threshold (1=yes, 0=no, per-service only)
LF_GLOBAL_THRESHOLD = "1"

# Combined threshold if LF_GLOBAL_THRESHOLD=1
LF_GLOBAL_LIMIT = "15"

# --- Blocking ---

# Default temporary block duration in seconds (3600=1hr, 86400=1day)
LF_TEMP_BLOCK_DURATION = "3600"

# Automatically promote to permanent block after this many temp blocks
# Set to 0 to disable auto-promotion
LF_PERM_BLOCK_AFTER = "3"

# Send email alerts on blocks (1=yes, 0=no)
LF_EMAIL_ALERT = "1"

# Alert email recipient
LF_ALERT_TO = "root"

# Alert email from address
LF_ALERT_FROM = "hostguard@localhost"

###############################################################################
# SECTION: Log Files to Monitor
###############################################################################

# Paths to log files that the daemon will tail
# The daemon auto-detects which files exist
LOG_SSHD = "/var/log/secure"
LOG_SSHD_ALT = "/var/log/auth.log"
LOG_FTPD = "/var/log/messages"
LOG_MAIL = "/var/log/maillog"
LOG_MAIL_ALT = "/var/log/mail.log"
LOG_CPANEL = "/usr/local/cpanel/logs/login_log"
LOG_CPANEL_ERROR = "/usr/local/cpanel/logs/error_log"

###############################################################################
# SECTION: Connection Limits
###############################################################################

# Connection tracking limit per IP (0=disabled)
# Format: "port;limit" - e.g. "22;5,80;50,443;50"
CONNLIMIT = "22;5,25;10"

# Port flood protection (0=disabled)
# Format: "port;hits;interval;protocol" - e.g., "22;5;300;tcp"
PORTFLOOD = ""

# SYN flood protection (1=yes, 0=no)
SYNFLOOD = "0"

# SYN flood rate limit
SYNFLOOD_RATE = "100/s"

# SYN flood burst limit
SYNFLOOD_BURST = "150"

###############################################################################
# SECTION: Logging
###############################################################################

# Daemon log file path
LOG_FILE = "/var/log/hostguard/daemon.log"

# Log level (0=errors only, 1=normal, 2=verbose, 3=debug)
LOG_LEVEL = "1"

# Maximum log file size in bytes before rotation (10MB default)
LOG_MAX_SIZE = "10485760"

###############################################################################
# SECTION: Advanced
###############################################################################

# Custom iptables binary path (empty = auto-detect)
IPTABLES = ""

# Custom ip6tables binary path (empty = auto-detect)
IP6TABLES = ""

# Custom ipset binary path (empty = auto-detect)
IPSET = ""

# Pre-firewall rules script (executed before main rules are applied)
# Must be executable. Leave empty to skip.
PRE_SCRIPT = ""

# Post-firewall rules script (executed after main rules are applied)
# Must be executable. Leave empty to skip.
POST_SCRIPT = ""

# Block report hook script (called when an IP is blocked)
# Receives arguments: IP REASON DURATION
# Leave empty to skip.
BLOCK_REPORT = ""
